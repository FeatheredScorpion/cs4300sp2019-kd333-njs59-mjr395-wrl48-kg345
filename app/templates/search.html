<html lang="en">
<head>
    <link rel="stylesheet" href="../static/styles/bootstrap.min.css">
    <link rel="stylesheet" href="../static/styles/main.css">
    <link rel="shortcut icon" type="image/png" href="../static/img/favicon-1.png"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>
<div class="topcorner">
    <p>Project Name: ROCKTAILS</p>
    <p>Students:</p>
    <li>Kerri Diamond: kd333</li>
    <li>Kaitlin Green: kg345</li>
    <li>William Lin: wrl48</li>
    <li>Megan Rochlin: mjr395</li>
    <li>Nathaniel Schickler: njs59</li>
</div>
<form class="form-inline global-search">
    <h1 style="font-size: 64px;font-weight:500; font-family:Quicksand, sans-serif; text-shadow: 2px 2px 2px #000000; color: #ffffff">
        ROCKTAILS
    </h1>

    <br><br>

    <div class="form-group">
        <input id="tags" type="text" name="search" class="form-control" placeholder="Your Input">
    </div>
    <button type="submit" class="btn btn-info">
        Go
    </button>
    {% if data %}
        <script style="display: none">
            var b;
            var a = fetch("../static/drinks.json")
                .then(function (myJson) {
                    return myJson.json();
                })
                .then(function (myJson) {
                    const url = new URL(window.location);
                    let searchStr = url.search;
                    searchStr = searchStr.substr(searchStr.indexOf('=') + 1, searchStr.length).toLowerCase();
                    JSON.parse(JSON.stringify(myJson))["drinks"].forEach(function (d) {
                        if (d.name.toLowerCase().indexOf(searchStr) > -1
                            || (d.ingredients && (d.ingredients.toString().toLowerCase().indexOf(searchStr) > -1))
                        ) {
                            var element = document.querySelector("div[data-type='template']").cloneNode(true);
                            element.querySelector("div.title").textContent = d.name;
                            element.querySelector("div#desc").textContent = d.description;
                            element.querySelector("p#ingredients").textContent = d.ingredients.toString();
                            element.querySelector("img.src").src = d.src;
                            element.style.display = "inline";
                            document.getElementById("drink-output").appendChild(element);
                        }
                    })
                })
            ;
        </script>
    {% endif %}
</form>

</div>
<div class="row">
    <div id="drink-output">
    <!-- template -->
    <div style="display: none;" data-type="template" id="drink-id" class="cocktail-card">
        <div class="card col-xs-4 col-sm-8 col-lg-8">
            <div class="thumbnail">
                <div class="display">
                    <img src='../static/img/drinks_noimg_1280.png' alt="No Image"
                         onerror="if (this.src != 'error.jpg') this.src = '../static/img/drinks_noimg_1280.png';"
                         class="src">
                </div>
                <h3 class="">
                    <div class="title">Thumbnail label</div>
                </h3>
                <p>Description:</p>
                <div id="desc" class="desc" style="overflow: auto;">
                </div>
                <br>
                <p>Ingredients:</p>
                <p id="ingredients"></p>
            </div>
        </div>
    </div>
</div>
</div>
<script>
    suggestions = [];

    function postData(input) {
        $.ajax({
            type: "POST",
            url: "/good-types/",
            data: {param: input},
            async: false,
            success: callbackFunc
        });
    }

    function callbackFunc(response) {
        // do something with the response
        suggestions = JSON.parse(response);
    }

    $(function () {
        postData("post data")
        console.log("hello");
        console.log(suggestions);
        var availableTags = suggestions;

        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        $("#tags")
        // don't navigate away from the field on tab when selecting an item
            .on("keydown", function (event) {
                if (event.keyCode === $.ui.keyCode.TAB &&
                    $(this).autocomplete("instance").menu.active) {
                    event.preventDefault();
                }
            })
            .autocomplete({
                minLength: 0,
                source: function (request, response) {
                    // delegate back to autocomplete, but extract the last term
                    response($.ui.autocomplete.filter(
                        availableTags, extractLast(request.term)));
                },
                focus: function () {
                    // prevent value inserted on focus
                    return false;
                },
                select: function (event, ui) {
                    var terms = split(this.value);
                    // remove the current input
                    terms.pop();
                    // add the selected item
                    terms.push(ui.item.value);
                    // add placeholder to get the comma-and-space at the end
                    terms.push("");
                    this.value = terms.join(", ");
                    return false;
                }
            });
    });

    const url = new URL(window.location);
    let searchStr = url.search;
    searchStr = searchStr.substr(searchStr.indexOf('=') + 1, searchStr.length).toLowerCase();

    function booleanSearch(searchStr) {
        $.ajax({
            type: "POST",
            url: "/booleanSearch/",
            data: {param: searchStr},
            async: false,
            success: callbackFunc
        });
    }

    function callbackFunc(response) {
        // do something with the response
        suggestions = JSON.parse(response);
    }
</script>
</body>
</html>